<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eFootball Tournament</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .glass-panel {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .neon-text {
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .loot-box {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: 3px solid #ffd700;
            animation: pulse-glow 2s infinite;
            cursor: pointer;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        .spinning { animation: spin 0.5s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .bg-stadium {
            background-image: url('/mnt/kimi/upload/file_000000003da871fdb26bf00223f60724.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
        }
        .hidden-section { display: none; }
        .active-section { display: block; }
        .match-card {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.9), rgba(42, 82, 152, 0.9));
            border: 2px solid #ffd700;
        }
        .screenshot-thumb {
            max-width: 100px;
            max-height: 80px;
            border: 2px solid #ffd700;
            border-radius: 4px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal img { max-width: 90%; max-height: 90%; border: 3px solid #ffd700; }
    </style>
</head>
<body class="bg-stadium min-h-screen text-white">

    <!-- Date Display -->
    <div class="fixed top-20 left-4 z-50 glass-panel px-4 py-2 rounded-lg text-yellow-400 font-bold text-sm">
        ðŸ“… <span id="todayDate">Loading...</span>
    </div>

    <!-- Last Visit -->
    <div class="fixed bottom-4 left-4 z-50 glass-panel px-4 py-2 rounded-lg text-yellow-400 text-xs">
        Last visit: <span id="lastVisitTime">Never</span>
    </div>

    <!-- Screenshot Modal -->
    <div id="imgModal" class="modal" onclick="closeModal()">
        <img id="modalImg" src="" alt="Screenshot">
    </div>

    <!-- Music Player -->
    <div class="fixed bottom-4 right-4 z-50 glass-panel rounded-full p-3 flex items-center gap-2">
        <button onclick="playMusic()" id="playBtn" class="w-10 h-10 rounded-full gold-gradient text-black font-bold">â–¶</button>
        <span class="text-xs font-bold text-yellow-400 hidden md:block">Me & U - Tems</span>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 glass-panel border-b border-yellow-500/30">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="font-orbitron text-xl font-black text-yellow-400 neon-text">EFOOTBALL<span class="text-white">TOURNAMENT</span></h1>
            <div class="flex gap-2 overflow-x-auto text-sm">
                <button onclick="showSection('welcome')" class="px-3 py-1 rounded bg-blue-600 hover:bg-blue-500 font-bold">Home</button>
                <button onclick="showSection('register')" class="px-3 py-1 rounded bg-purple-600 hover:bg-purple-500 font-bold">Register</button>
                <button onclick="showSection('lootbox')" class="px-3 py-1 rounded bg-yellow-600 hover:bg-yellow-500 text-black font-bold">Loot Box</button>
                <button onclick="showSection('results')" class="px-3 py-1 rounded bg-red-600 hover:bg-red-500 font-bold">Results</button>
                <button onclick="showSection('standings')" class="px-3 py-1 rounded bg-green-600 hover:bg-green-500 font-bold">Standings</button>
            </div>
        </div>
    </nav>

    <!-- Welcome -->
    <section id="welcome" class="active-section pt-24 min-h-screen flex items-center justify-center px-4">
        <div class="glass-panel rounded-2xl p-8 max-w-md w-full text-center">
            <div class="text-5xl mb-4">âš½</div>
            <h2 class="font-orbitron text-3xl font-bold mb-2 text-yellow-400">Welcome Konamist!</h2>
            <p class="text-gray-300 mb-4">16 players. One champion.</p>
            <input type="text" id="username" placeholder="Enter your username" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-yellow-500/50 text-white text-center font-bold mb-4">
            <button onclick="enterTournament()" class="w-full py-3 rounded-lg gold-gradient text-black font-bold text-lg">ENTER TOURNAMENT</button>
            <div id="welcomeMsg" class="mt-4 hidden text-yellow-400 font-bold text-xl">Welcome, <span id="userDisplay"></span>!</div>
        </div>
    </section>

    <!-- Registration -->
    <section id="register" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-4xl">
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="font-orbitron text-2xl font-bold text-center mb-6 text-yellow-400">Player Registration</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <input type="text" id="coachName" placeholder="Coach Name" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <input type="text" id="teamStrength" placeholder="Team Strength (any number)" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <input type="text" id="favoritePlayer" placeholder="Favorite Player" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <button onclick="registerPlayer()" class="w-full py-3 rounded-lg bg-purple-600 hover:bg-purple-500 font-bold">REGISTER</button>
                    </div>
                    <div class="glass-panel rounded-xl p-4 bg-black/40">
                        <h3 class="font-bold text-yellow-400 mb-2">Players (<span id="playerCount">0</span>)</h3>
                        <div id="playersList" class="space-y-2 max-h-80 overflow-y-auto text-sm"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Loot Box -->
    <section id="lootbox" class="hidden-section pt-24 min-h-screen px-4 pb-12 flex items-center justify-center">
        <div class="text-center max-w-4xl w-full">
            <h2 class="font-orbitron text-3xl font-bold mb-6 text-yellow-400">MATCHMAKING</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="loot-box rounded-2xl p-10 h-64 flex items-center justify-center" onclick="spinBox()" id="lootBox">
                    <div class="text-center">
                        <div class="text-6xl mb-2" id="boxIcon">ðŸŽ²</div>
                        <p class="font-bold text-xl">CLICK TO SPIN</p>
                    </div>
                </div>
                <div class="glass-panel rounded-2xl p-4 text-left">
                    <h3 class="font-bold text-yellow-400 mb-2">Brackets</h3>
                    <div id="brackets" class="space-y-2 max-h-80 overflow-y-auto text-sm"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Results -->
    <section id="results" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-4xl">
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="font-orbitron text-2xl font-bold text-center mb-6 text-yellow-400">Submit Result</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <select id="p1" class="w-full px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white"></select>
                        <div class="flex gap-2">
                            <input type="number" id="g1" placeholder="0" class="w-1/2 px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white text-center text-2xl font-bold">
                            <input type="number" id="g2" placeholder="0" class="w-1/2 px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white text-center text-2xl font-bold">
                        </div>
                        <select id="p2" class="w-full px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white"></select>
                        <input type="file" id="screenshot" accept="image/*" onchange="previewImg(this)" class="w-full text-sm">
                        <div id="imgPreview" class="hidden">
                            <img id="prevImg" class="max-h-32 border-2 border-yellow-500 rounded cursor-pointer" onclick="openModal(this.src)">
                        </div>
                        <button onclick="submitResult()" class="w-full py-3 rounded-lg bg-red-600 hover:bg-red-500 font-bold">SUBMIT</button>
                    </div>
                    <div>
                        <h3 class="font-bold text-yellow-400 mb-2">Recent Results</h3>
                        <div id="resultsList" class="space-y-2 max-h-64 overflow-y-auto text-sm"></div>
                        <div class="mt-4 p-3 bg-blue-900/50 rounded border border-yellow-500/30 text-center">
                            <div class="flex justify-around">
                                <div><span class="block text-xl font-bold text-green-400" id="statMatches">0</span>Matches</div>
                                <div><span class="block text-xl font-bold text-yellow-400" id="statGoals">0</span>Goals</div>
                                <div><span class="block text-xl font-bold text-blue-400" id="statAvg">0</span>Avg</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Standings -->
    <section id="standings" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-5xl">
            <div class="glass-panel rounded-2xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-orbitron text-2xl font-bold text-yellow-400">Standings</h2>
                    <button onclick="resetAll()" class="px-3 py-1 bg-red-800 rounded text-sm font-bold">Reset</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-yellow-400 border-b border-yellow-500/50">
                            <tr>
                                <th class="pb-2 pl-2">#</th>
                                <th class="pb-2">Player</th>
                                <th class="pb-2 text-center">P</th>
                                <th class="pb-2 text-center">W</th>
                                <th class="pb-2 text-center">D</th>
                                <th class="pb-2 text-center">L</th>
                                <th class="pb-2 text-center">GF</th>
                                <th class="pb-2 text-center">GA</th>
                                <th class="pb-2 text-center">GD</th>
                                <th class="pb-2 text-center pr-2">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="standingsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Firebase Config - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyB8QaL7XYZ1234567890abcdefg",
            authDomain: "efootball-tournament-2024.firebaseapp.com",
            databaseURL: "https://efootball-tournament-2024-default-rtdb.firebaseio.com",
            projectId: "efootball-tournament-2024",
            storageBucket: "efootball-tournament-2024.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890"
        };

        // Initialize
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            console.log("Firebase OK");
        } catch(e) {
            console.log("Firebase error:", e);
            alert("Firebase not configured! Add your config in the code.");
        }

        let currentUser = '';
        let players = [];
        let results = [];
        let standings = [];

        // Date & Visit
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('todayDate').textContent = now.toLocaleDateString('en-US', options);
        }

        function saveVisit() {
            const now = new Date();
            const timeStr = now.toLocaleString();
            localStorage.setItem('lastVisit', timeStr);
            document.getElementById('lastVisitTime').textContent = timeStr;
        }

        // Music
        function playMusic() {
            const audio = document.createElement('audio');
            audio.src = 'me-and-u-tems.mp3';
            audio.loop = true;
            audio.play().then(() => {
                document.getElementById('playBtn').textContent = 'â¸';
                document.getElementById('playBtn').onclick = function() {
                    audio.pause();
                    this.textContent = 'â–¶';
                    this.onclick = playMusic;
                };
            }).catch(e => {
                alert("Music file not found! Add 'me-and-u-tems.mp3' in same folder.");
            });
        }

        // Navigation
        function showSection(id) {
            document.querySelectorAll('section').forEach(s => {
                s.classList.remove('active-section');
                s.classList.add('hidden-section');
            });
            document.getElementById(id).classList.remove('hidden-section');
            document.getElementById(id).classList.add('active-section');
            updateDate();
        }

        // Welcome
        function enterTournament() {
            const name = document.getElementById('username').value.trim();
            if (!name) return alert('Enter username!');
            currentUser = name;
            document.getElementById('userDisplay').textContent = name;
            document.getElementById('welcomeMsg').classList.remove('hidden');
            setTimeout(() => showSection('register'), 1000);
        }

        // Registration
        function registerPlayer() {
            const coach = document.getElementById('coachName').value.trim();
            const strength = document.getElementById('teamStrength').value.trim();
            const favorite = document.getElementById('favoritePlayer').value.trim();

            if (!coach || !strength || !favorite) return alert('Fill all fields!');

            if (db) {
                const id = Date.now();
                db.ref('players/' + id).set({
                    id, username: currentUser || 'Guest', coach, strength, favorite,
                    time: new Date().toLocaleString()
                });
                
                // Init standings
                db.ref('standings/' + coach).set({
                    coach, p:0, w:0, d:0, l:0, gf:0, ga:0, pts:0
                });
            }

            document.getElementById('coachName').value = '';
            document.getElementById('teamStrength').value = '';
            document.getElementById('favoritePlayer').value = '';
            alert('Registered!');
        }

        function updatePlayerList() {
            const list = document.getElementById('playersList');
            document.getElementById('playerCount').textContent = players.length;
            
            if (players.length === 0) {
                list.innerHTML = '<p class="text-gray-400">No players yet</p>';
                return;
            }
            
            list.innerHTML = players.map(p => `
                <div class="bg-blue-900/30 p-2 rounded border border-blue-500/30">
                    <div class="flex justify-between font-bold text-yellow-400">
                        <span>${p.coach}</span>
                        <span>${p.strength} STR</span>
                    </div>
                    <div class="text-xs text-gray-300">By: ${p.username} | Fav: ${p.favorite}</div>
                </div>
            `).join('');
            
            // Update selects
            const opts = players.map(p => `<option value="${p.coach}">${p.coach}</option>`).join('');
            document.getElementById('p1').innerHTML = '<option value="">Select Player 1</option>' + opts;
            document.getElementById('p2').innerHTML = '<option value="">Select Player 2</option>' + opts;
        }

        // Loot Box
        function spinBox() {
            if (players.length < 2) return alert('Need 2+ players!');
            
            const box = document.getElementById('lootBox');
            const icon = document.getElementById('boxIcon');
            box.classList.add('spinning');
            icon.textContent = 'âš½';
            
            setTimeout(() => {
                box.classList.remove('spinning');
                icon.textContent = 'ðŸŽ²';
                makeBrackets();
            }, 1500);
        }

        function makeBrackets() {
            const shuffled = [...players].sort(() => Math.random() - 0.5);
            const box = document.getElementById('brackets');
            let html = '';
            
            for (let i = 0; i < shuffled.length; i += 2) {
                const p1 = shuffled[i];
                const p2 = shuffled[i + 1];
                if (p2) {
                    html += `
                        <div class="match-card p-3 rounded flex justify-between items-center cursor-pointer hover:bg-blue-800/50" onclick="selectMatch('${p1.coach}','${p2.coach}')">
                            <div class="text-right flex-1">
                                <div class="font-bold text-yellow-400">${p1.coach}</div>
                                <div class="text-xs">${p1.strength}</div>
                            </div>
                            <div class="px-3 font-bold text-red-500">VS</div>
                            <div class="flex-1">
                                <div class="font-bold text-yellow-400">${p2.coach}</div>
                                <div class="text-xs">${p2.strength}</div>
                            </div>
                        </div>
                    `;
                }
            }
            box.innerHTML = html || '<p class="text-gray-400">Not enough players</p>';
        }

        function selectMatch(a, b) {
            showSection
