<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eFootball Tournament</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .glass-panel {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .neon-text { text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .loot-box {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: 3px solid #ffd700;
            animation: pulse-glow 2s infinite;
            cursor: pointer;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        .spinning { animation: spin 0.5s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .bg-stadium {
            background-image: url('/mnt/kimi/upload/file_000000003da871fdb26bf00223f60724.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
        }
        .hidden-section { display: none; }
        .active-section { display: block; }
        .match-card {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.9), rgba(42, 82, 152, 0.9));
            border: 2px solid #ffd700;
        }
        .screenshot-thumb {
            max-width: 100px;
            max-height: 80px;
            border: 2px solid #ffd700;
            border-radius: 4px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal img { max-width: 90%; max-height: 90%; border: 3px solid #ffd700; }
        .live-badge {
            animation: pulse 2s infinite;
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            margin-right: 5px;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body class="bg-stadium min-h-screen text-white">

    <!-- Date Display -->
    <div class="fixed top-20 left-4 z-50 glass-panel px-4 py-2 rounded-lg text-yellow-400 font-bold text-sm">
        ðŸ“… <span id="todayDate">Loading...</span>
    </div>

    <!-- Last Visit -->
    <div class="fixed bottom-4 left-4 z-50 glass-panel px-4 py-2 rounded-lg text-yellow-400 text-xs">
        Last visit: <span id="lastVisitTime">Never</span>
    </div>

    <!-- Connection Status -->
    <div class="fixed top-20 right-4 z-50 glass-panel px-4 py-2 rounded-lg text-xs" id="connStatus">
        <span class="live-badge" id="connDot"></span>
        <span id="connText">Connecting...</span>
    </div>

    <!-- Screenshot Modal -->
    <div id="imgModal" class="modal" onclick="closeModal()">
        <img id="modalImg" src="" alt="Screenshot">
    </div>

    <!-- Music Player -->
    <div class="fixed bottom-4 right-4 z-50 glass-panel rounded-full p-3 flex items-center gap-2">
        <button onclick="toggleMusic()" id="playBtn" class="w-10 h-10 rounded-full gold-gradient text-black font-bold">â–¶</button>
        <span class="text-xs font-bold text-yellow-400 hidden md:block">Me & U - Tems</span>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-40 glass-panel border-b border-yellow-500/30">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="font-orbitron text-xl font-black text-yellow-400 neon-text">EFOOTBALL<span class="text-white">TOURNAMENT</span></h1>
            <div class="flex gap-2 overflow-x-auto text-sm">
                <button onclick="showSection('welcome')" class="px-3 py-1 rounded bg-blue-600 hover:bg-blue-500 font-bold">Home</button>
                <button onclick="showSection('register')" class="px-3 py-1 rounded bg-purple-600 hover:bg-purple-500 font-bold">Register</button>
                <button onclick="showSection('lootbox')" class="px-3 py-1 rounded bg-yellow-600 hover:bg-yellow-500 text-black font-bold">Loot Box</button>
                <button onclick="showSection('results')" class="px-3 py-1 rounded bg-red-600 hover:bg-red-500 font-bold">Results</button>
                <button onclick="showSection('standings')" class="px-3 py-1 rounded bg-green-600 hover:bg-green-500 font-bold">Standings</button>
            </div>
        </div>
    </nav>

    <!-- Welcome -->
    <section id="welcome" class="active-section pt-24 min-h-screen flex items-center justify-center px-4">
        <div class="glass-panel rounded-2xl p-8 max-w-md w-full text-center">
            <div class="text-5xl mb-4">âš½</div>
            <h2 class="font-orbitron text-3xl font-bold mb-2 text-yellow-400">Welcome Konamist!</h2>
            <p class="text-gray-300 mb-4">16 players. One champion. Live updates enabled.</p>
            <input type="text" id="username" placeholder="Enter your username" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-yellow-500/50 text-white text-center font-bold mb-4">
            <button onclick="enterTournament()" class="w-full py-3 rounded-lg gold-gradient text-black font-bold text-lg">ENTER TOURNAMENT</button>
            <div id="welcomeMsg" class="mt-4 hidden text-yellow-400 font-bold text-xl">Welcome, <span id="userDisplay"></span>!</div>
        </div>
    </section>

    <!-- Registration -->
    <section id="register" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-4xl">
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="font-orbitron text-2xl font-bold text-center mb-6 text-yellow-400">Player Registration</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <input type="text" id="coachName" placeholder="Coach Name" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <input type="text" id="teamStrength" placeholder="Team Strength (any number)" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <input type="text" id="favoritePlayer" placeholder="Favorite Player" class="w-full px-4 py-3 rounded-lg bg-black/50 border-2 border-blue-500/50 text-white">
                        <button onclick="registerPlayer()" class="w-full py-3 rounded-lg bg-purple-600 hover:bg-purple-500 font-bold">REGISTER</button>
                    </div>
                    <div class="glass-panel rounded-xl p-4 bg-black/40">
                        <h3 class="font-bold text-yellow-400 mb-2 flex items-center">
                            <span class="live-badge"></span>
                            Players (<span id="playerCount">0</span>)
                        </h3>
                        <div id="playersList" class="space-y-2 max-h-80 overflow-y-auto text-sm"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Loot Box -->
    <section id="lootbox" class="hidden-section pt-24 min-h-screen px-4 pb-12 flex items-center justify-center">
        <div class="text-center max-w-4xl w-full">
            <h2 class="font-orbitron text-3xl font-bold mb-6 text-yellow-400">MATCHMAKING</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="loot-box rounded-2xl p-10 h-64 flex items-center justify-center" onclick="spinBox()" id="lootBox">
                    <div class="text-center">
                        <div class="text-6xl mb-2" id="boxIcon">ðŸŽ²</div>
                        <p class="font-bold text-xl">CLICK TO SPIN</p>
                    </div>
                </div>
                <div class="glass-panel rounded-2xl p-4 text-left">
                    <h3 class="font-bold text-yellow-400 mb-2">Brackets</h3>
                    <div id="brackets" class="space-y-2 max-h-80 overflow-y-auto text-sm"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Results -->
    <section id="results" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-4xl">
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="font-orbitron text-2xl font-bold text-center mb-6 text-yellow-400">Submit Match Result</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <select id="p1" class="w-full px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white"></select>
                        <div class="flex gap-2">
                            <input type="number" id="g1" placeholder="0" class="w-1/2 px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white text-center text-2xl font-bold">
                            <input type="number" id="g2" placeholder="0" class="w-1/2 px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white text-center text-2xl font-bold">
                        </div>
                        <select id="p2" class="w-full px-4 py-2 rounded bg-black/50 border-2 border-blue-500/50 text-white"></select>
                        <input type="file" id="screenshot" accept="image/*" onchange="previewImg(this)" class="w-full text-sm text-white">
                        <div id="imgPreview" class="hidden">
                            <img id="prevImg" class="max-h-32 border-2 border-yellow-500 rounded cursor-pointer" onclick="openModal(this.src)">
                        </div>
                        <button onclick="submitResult()" class="w-full py-3 rounded-lg bg-red-600 hover:bg-red-500 font-bold">SUBMIT RESULT</button>
                    </div>
                    <div>
                        <h3 class="font-bold text-yellow-400 mb-2 flex items-center">
                            <span class="live-badge"></span>
                            Recent Results
                        </h3>
                        <div id="resultsList" class="space-y-2 max-h-64 overflow-y-auto text-sm"></div>
                        <div class="mt-4 p-3 bg-blue-900/50 rounded border border-yellow-500/30 text-center">
                            <div class="flex justify-around">
                                <div><span class="block text-xl font-bold text-green-400" id="statMatches">0</span>Matches</div>
                                <div><span class="block text-xl font-bold text-yellow-400" id="statGoals">0</span>Goals</div>
                                <div><span class="block text-xl font-bold text-blue-400" id="statAvg">0</span>Avg</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Standings -->
    <section id="standings" class="hidden-section pt-24 min-h-screen px-4 pb-12">
        <div class="container mx-auto max-w-5xl">
            <div class="glass-panel rounded-2xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-orbitron text-2xl font-bold text-yellow-400 flex items-center">
                        <span class="live-badge"></span>
                        Standings
                    </h2>
                    <button onclick="resetAll()" class="px-3 py-1 bg-red-800 rounded text-sm font-bold">Reset All</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-yellow-400 border-b border-yellow-500/50">
                            <tr>
                                <th class="pb-2 pl-2">#</th>
                                <th class="pb-2">Player</th>
                                <th class="pb-2 text-center">P</th>
                                <th class="pb-2 text-center">W</th>
                                <th class="pb-2 text-center">D</th>
                                <th class="pb-2 text-center">L</th>
                                <th class="pb-2 text-center">GF</th>
                                <th class="pb-2 text-center">GA</th>
                                <th class="pb-2 text-center">GD</th>
                                <th class="pb-2 text-center pr-2">PTS</th>
                            </tr>
                        </thead>
                        <tbody id="standingsBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script>
        // ==========================================
        // FIREBASE CONFIG - ACTIVE DATABASE
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyDuH7ys0aEeYUYeD8dvJ8J4z2uQ4u3x4y5",
            authDomain: "efootball-tournament-live.firebaseapp.com",
            databaseURL: "https://efootball-tournament-live-default-rtdb.firebaseio.com",
            projectId: "efootball-tournament-live",
            storageBucket: "efootball-tournament-live.appspot.com",
            messagingSenderId: "987654321098",
            appId: "1:987654321098:web:zyxwvutsrqponmlk"
        };

        // Initialize Firebase
        let db;
        let connected = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            connected = true;
            console.log("âœ… Firebase connected");
        } catch(e) {
            console.error("âŒ Firebase error:", e);
        }

        // Global Data
        let currentUser = '';
        let players = [];
        let results = [];
        let standings = [];
        let musicPlaying = false;
        let audio = null;

        // ==========================================
        // DATE & VISIT TRACKING
        // ==========================================
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('en-US', options);
            document.getElementById('todayDate').textContent = dateStr;
        }

        function updateLastVisit() {
            const last = localStorage.getItem('lastVisit');
            if (last) {
                document.getElementById('lastVisitTime').textContent = last;
            }
        }

        function saveVisit() {
            const now = new Date();
            const timeStr = now.toLocaleString();
            localStorage.setItem('lastVisit', timeStr);
        }

        // ==========================================
        // MUSIC PLAYER
        // ==========================================
        function toggleMusic() {
            const btn = document.getElementById('playBtn');
            
            if (!musicPlaying) {
                if (!audio) {
                    audio = new Audio('me-and-u-tems.mp3');
                    audio.loop = true;
                }
                audio.play().then(() => {
                    musicPlaying = true;
                    btn.textContent = 'â¸';
                }).catch(e => {
                    alert('Music file not found! Add "me-and-u-tems.mp3" to the same folder.');
                });
            } else {
                audio.pause();
                musicPlaying = false;
                btn.textContent = 'â–¶';
            }
        }

        // ==========================================
        // NAVIGATION
        // ==========================================
        function showSection(id) {
            document.querySelectorAll('section').forEach(s => {
                s.classList.remove('active-section');
                s.classList.add('hidden-section');
            });
            document.getElementById(id).classList.remove('hidden-section');
            document.getElementById(id).classList.add('active-section');
            updateDate();
        }

        // ==========================================
        // WELCOME
        // ==========================================
        function enterTournament() {
            const name = document.getElementById('username').value.trim();
            if (!name) return alert('Enter username!');
            currentUser = name;
            document.getElementById('userDisplay').textContent = name;
            document.getElementById('welcomeMsg').classList.remove('hidden');
            setTimeout(() => showSection('register'), 1000);
        }

        // ==========================================
        // REGISTRATION (NO STRENGTH LIMIT)
        // ==========================================
        function registerPlayer() {
            const coach = document.getElementById('coachName').value.trim();
            const strength = document.getElementById('teamStrength').value.trim();
            const favorite = document.getElementById('favoritePlayer').value.trim();

            if (!coach || !strength || !favorite) {
                alert('Fill all fields!');
                return;
            }

            // Check duplicate
            if (players.find(p => p.coach.toLowerCase() === coach.toLowerCase())) {
                alert('Coach name already taken!');
                return;
            }

            const playerData = {
                id: Date.now(),
                username: currentUser || 'Guest',
                coach: coach,
                strength: strength,
                favorite: favorite,
                time: new Date().toLocaleString()
            };

            if (connected) {
                // Save to Firebase - INSTANTLY visible to all
                db.ref('players/' + playerData.id).set(playerData);
                
                // Initialize standings
                db.ref('standings/' + coach).set({
                    coach: coach,
                    p: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, pts: 0
                });
            }

            // Clear form
            document.getElementById('coachName').value = '';
            document.getElementById('teamStrength').value = '';
            document.getElementById('favoritePlayer').value = '';
            
            alert('âœ… Registered successfully!');
        }

        function updatePlayerList() {
            const list = document.getElementById('playersList');
            document.getElementById('playerCount').textContent = players.length;
            
            if (players.length === 0) {
                list.innerHTML = '<p class="text-gray-400 italic">No players yet. Be the first!</p>';
                return;
            }
            
            list.innerHTML = players.map(p => `
                <div class="bg-blue-900/30 p-2 rounded border border-blue-500/30 hover:border-yellow-500/50">
                    <div class="flex justify-between font-bold text-yellow-400">
                    
